# üõí Backend E-commerce - Node.js + Express + SQLite

Backend complet pour application e-commerce avec authentification JWT, gestion de produits, panier, commandes, avis et wishlist.

## üìã Table des mati√®res

- [Caract√©ristiques](#-caract√©ristiques)
- [Stack technique](#-stack-technique)
- [Installation](#-installation)
- [Configuration](#-configuration)
- [Utilisation](#-utilisation)
- [Documentation API](#-documentation-api)
- [Structure du projet](#-structure-du-projet)
- [Base de donn√©es](#-base-de-donn√©es)
- [S√©curit√©](#-s√©curit√©)

## ‚ú® Caract√©ristiques

- ‚úÖ **Authentification JWT** compl√®te (inscription, connexion)
- ‚úÖ **Gestion des utilisateurs** avec r√¥les (user, admin)
- ‚úÖ **CRUD Produits** avec pagination, recherche et filtres
- ‚úÖ **Gestion des cat√©gories**
- ‚úÖ **Panier d'achat** (ajouter, modifier, supprimer)
- ‚úÖ **Syst√®me de commandes** avec gestion des statuts
- ‚úÖ **Avis et notes** sur les produits
- ‚úÖ **Wishlist/Favoris**
- ‚úÖ **Validation des donn√©es** avec express-validator
- ‚úÖ **Gestion d'erreurs** centralis√©e
- ‚úÖ **S√©curit√©** : bcrypt, helmet, CORS

## üõ† Stack technique

- **Runtime** : Node.js
- **Framework** : Express.js
- **Base de donn√©es** : SQLite3
- **Authentification** : JWT (jsonwebtoken)
- **Hashing** : bcryptjs
- **Validation** : express-validator
- **S√©curit√©** : helmet, cors
- **Environnement** : dotenv

## üì¶ Installation

### Pr√©requis

- Node.js (v14 ou sup√©rieur)
- npm ou yarn

### √âtapes

1. **Cloner le projet**
   ```bash
   git clone <url-du-repo>
   cd ecommerce-backend
   ```

2. **Installer les d√©pendances**
   ```bash
   npm install
   ```

3. **Configurer les variables d'environnement**
   ```bash
   cp .env.example .env
   ```

   Modifier le fichier `.env` :
   ```env
   PORT=3000
   NODE_ENV=development
   JWT_SECRET=votre_secret_jwt_super_securise
   JWT_EXPIRES_IN=24h
   DB_PATH=./ecommerce.db
   ```

4. **Initialiser la base de donn√©es avec des donn√©es de test**
   ```bash
   npm run seed
   ```

5. **D√©marrer le serveur**
   ```bash
   # Mode d√©veloppement (avec nodemon)
   npm run dev

   # Mode production
   npm start
   ```

Le serveur d√©marre sur `http://localhost:3000`

## ‚öôÔ∏è Configuration

### Variables d'environnement

| Variable | Description | D√©faut |
|----------|-------------|---------|
| `PORT` | Port du serveur | `3000` |
| `NODE_ENV` | Environnement (development/production) | `development` |
| `JWT_SECRET` | Secret pour signer les tokens JWT | **REQUIS** |
| `JWT_EXPIRES_IN` | Dur√©e de validit√© du token | `24h` |
| `DB_PATH` | Chemin vers la base SQLite | `./ecommerce.db` |

## üöÄ Utilisation

### Comptes de test (apr√®s seed)

**Admin**
- Email: `admin@ecommerce.com`
- Password: `admin123`

**Utilisateur**
- Email: `john@example.com`
- Password: `user123`

### Scripts disponibles

```bash
npm start      # D√©marrer le serveur
npm run dev    # D√©marrer en mode d√©veloppement
npm run seed   # Remplir la DB avec donn√©es de test
```

## üìö Documentation API

### URL de base

```
http://localhost:3000/api
```

### Codes de r√©ponse HTTP

| Code | Description |
|------|-------------|
| 200 | Succ√®s |
| 201 | Cr√©√© avec succ√®s |
| 400 | Requ√™te invalide |
| 401 | Non authentifi√© |
| 403 | Acc√®s interdit |
| 404 | Ressource non trouv√©e |
| 500 | Erreur serveur |

### Format des r√©ponses

**Succ√®s**
```json
{
  "success": true,
  "message": "Message de succ√®s",
  "data": { ... }
}
```

**Erreur**
```json
{
  "success": false,
  "message": "Message d'erreur",
  "errors": [ ... ]
}
```

---

## üîê Authentification

### 1. Inscription

**Endpoint** : `POST /api/auth/register`

**Body** :
```json
{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123"
}
```

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "John Doe",
    "email": "john@example.com",
    "password": "password123"
  }'
```

**R√©ponse** :
```json
{
  "success": true,
  "message": "Utilisateur cr√©√© avec succ√®s",
  "data": {
    "id": 1,
    "name": "John Doe",
    "email": "john@example.com",
    "role": "user"
  }
}
```

### 2. Connexion

**Endpoint** : `POST /api/auth/login`

**Body** :
```json
{
  "email": "john@example.com",
  "password": "password123"
}
```

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "password": "password123"
  }'
```

**R√©ponse** :
```json
{
  "success": true,
  "message": "Connexion r√©ussie",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "name": "John Doe",
      "email": "john@example.com",
      "role": "user"
    }
  }
}
```

### 3. Profil utilisateur

**Endpoint** : `GET /api/auth/profile`
**Authentification** : Requise

**Headers** :
```
Authorization: Bearer <token>
```

**Exemple curl** :
```bash
curl -X GET http://localhost:3000/api/auth/profile \
  -H "Authorization: Bearer <votre_token>"
```

---

## üì¶ Produits

### 1. Lister tous les produits

**Endpoint** : `GET /api/products`

**Query params** :
- `page` (number) : Num√©ro de page (d√©faut: 1)
- `limit` (number) : √âl√©ments par page (d√©faut: 10)
- `category_id` (number) : Filtrer par cat√©gorie
- `search` (string) : Recherche dans nom/description
- `min_price` (number) : Prix minimum
- `max_price` (number) : Prix maximum

**Exemple curl** :
```bash
# Tous les produits
curl http://localhost:3000/api/products

# Avec filtres
curl "http://localhost:3000/api/products?page=1&limit=5&category_id=1&search=iphone&min_price=100&max_price=2000"
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "products": [
      {
        "id": 1,
        "name": "iPhone 15 Pro",
        "description": "Smartphone Apple...",
        "price": 1199.99,
        "stock": 25,
        "category_id": 1,
        "category_name": "√âlectronique",
        "image_url": "https://...",
        "created_at": "2024-01-01 10:00:00"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 16,
      "totalPages": 2
    }
  }
}
```

### 2. D√©tails d'un produit

**Endpoint** : `GET /api/products/:id`

**Exemple curl** :
```bash
curl http://localhost:3000/api/products/1
```

**R√©ponse** : Inclut les avis et la note moyenne

### 3. Cr√©er un produit (Admin)

**Endpoint** : `POST /api/products`
**Authentification** : Requise (Admin)

**Body** :
```json
{
  "name": "Nouveau produit",
  "description": "Description du produit",
  "price": 99.99,
  "stock": 50,
  "category_id": 1,
  "image_url": "https://..."
}
```

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/products \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Nouveau produit",
    "description": "Description",
    "price": 99.99,
    "stock": 50,
    "category_id": 1
  }'
```

### 4. Modifier un produit (Admin)

**Endpoint** : `PUT /api/products/:id`
**Authentification** : Requise (Admin)

**Exemple curl** :
```bash
curl -X PUT http://localhost:3000/api/products/1 \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "price": 1099.99,
    "stock": 30
  }'
```

### 5. Supprimer un produit (Admin)

**Endpoint** : `DELETE /api/products/:id`
**Authentification** : Requise (Admin)

**Exemple curl** :
```bash
curl -X DELETE http://localhost:3000/api/products/1 \
  -H "Authorization: Bearer <admin_token>"
```

---

## üìÅ Cat√©gories

### 1. Lister toutes les cat√©gories

**Endpoint** : `GET /api/categories`

**Exemple curl** :
```bash
curl http://localhost:3000/api/categories
```

### 2. D√©tails d'une cat√©gorie

**Endpoint** : `GET /api/categories/:id`

Retourne la cat√©gorie avec tous ses produits.

### 3. Cr√©er une cat√©gorie (Admin)

**Endpoint** : `POST /api/categories`
**Authentification** : Requise (Admin)

**Body** :
```json
{
  "name": "Nouvelle cat√©gorie",
  "description": "Description de la cat√©gorie"
}
```

### 4. Modifier une cat√©gorie (Admin)

**Endpoint** : `PUT /api/categories/:id`

### 5. Supprimer une cat√©gorie (Admin)

**Endpoint** : `DELETE /api/categories/:id`

---

## üõí Panier

**Toutes les routes n√©cessitent une authentification**

### 1. Voir mon panier

**Endpoint** : `GET /api/cart`

**Exemple curl** :
```bash
curl http://localhost:3000/api/cart \
  -H "Authorization: Bearer <token>"
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "cart_id": 1,
    "items": [
      {
        "id": 1,
        "product_id": 1,
        "name": "iPhone 15 Pro",
        "price": 1199.99,
        "quantity": 1,
        "stock": 25,
        "subtotal": 1199.99,
        "image_url": "https://..."
      }
    ],
    "total": "1199.99",
    "items_count": 1
  }
}
```

### 2. Ajouter au panier

**Endpoint** : `POST /api/cart/add`

**Body** :
```json
{
  "product_id": 1,
  "quantity": 2
}
```

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/cart/add \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "product_id": 1,
    "quantity": 2
  }'
```

### 3. Modifier la quantit√©

**Endpoint** : `PUT /api/cart/item/:item_id`

**Body** :
```json
{
  "quantity": 3
}
```

### 4. Retirer un article

**Endpoint** : `DELETE /api/cart/item/:item_id`

**Exemple curl** :
```bash
curl -X DELETE http://localhost:3000/api/cart/item/1 \
  -H "Authorization: Bearer <token>"
```

### 5. Vider le panier

**Endpoint** : `DELETE /api/cart/clear`

---

## üìù Commandes

**Toutes les routes n√©cessitent une authentification**

### 1. Cr√©er une commande (depuis le panier)

**Endpoint** : `POST /api/orders`

Cr√©e une commande √† partir des articles du panier, met √† jour le stock et vide le panier.

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/orders \
  -H "Authorization: Bearer <token>"
```

**R√©ponse** :
```json
{
  "success": true,
  "message": "Commande cr√©√©e avec succ√®s",
  "data": {
    "order_id": 1,
    "total": "1479.98",
    "status": "pending"
  }
}
```

### 2. Mes commandes

**Endpoint** : `GET /api/orders/my-orders`

**Exemple curl** :
```bash
curl http://localhost:3000/api/orders/my-orders \
  -H "Authorization: Bearer <token>"
```

### 3. D√©tails d'une commande

**Endpoint** : `GET /api/orders/:id`

**Exemple curl** :
```bash
curl http://localhost:3000/api/orders/1 \
  -H "Authorization: Bearer <token>"
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "id": 1,
    "user_id": 2,
    "total": 1479.98,
    "status": "pending",
    "created_at": "2024-01-01 14:30:00",
    "items": [
      {
        "id": 1,
        "product_id": 1,
        "name": "iPhone 15 Pro",
        "quantity": 1,
        "unit_price": 1199.99,
        "image_url": "https://..."
      },
      {
        "id": 2,
        "product_id": 4,
        "name": "AirPods Pro",
        "quantity": 1,
        "unit_price": 279.99,
        "image_url": "https://..."
      }
    ]
  }
}
```

### 4. Toutes les commandes (Admin)

**Endpoint** : `GET /api/orders`
**Authentification** : Requise (Admin)

**Query params** :
- `page` : Num√©ro de page
- `limit` : √âl√©ments par page
- `status` : Filtrer par statut

**Exemple curl** :
```bash
curl "http://localhost:3000/api/orders?page=1&limit=10&status=pending" \
  -H "Authorization: Bearer <admin_token>"
```

### 5. Mettre √† jour le statut (Admin)

**Endpoint** : `PUT /api/orders/:id/status`
**Authentification** : Requise (Admin)

**Body** :
```json
{
  "status": "shipped"
}
```

**Statuts valides** : `pending`, `processing`, `shipped`, `delivered`, `cancelled`

**Exemple curl** :
```bash
curl -X PUT http://localhost:3000/api/orders/1/status \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{"status": "shipped"}'
```

---

## ‚≠ê Avis et Notes

### 1. Avis d'un produit

**Endpoint** : `GET /api/reviews/product/:product_id`

**Exemple curl** :
```bash
curl http://localhost:3000/api/reviews/product/1
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "reviews": [
      {
        "id": 1,
        "product_id": 1,
        "user_id": 2,
        "user_name": "John Doe",
        "rating": 5,
        "comment": "Excellent produit !",
        "created_at": "2024-01-01 15:00:00"
      }
    ],
    "avg_rating": "4.5",
    "reviews_count": 2
  }
}
```

### 2. Cr√©er un avis

**Endpoint** : `POST /api/reviews/product/:product_id`
**Authentification** : Requise

**Body** :
```json
{
  "rating": 5,
  "comment": "Excellent produit, je recommande !"
}
```

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/reviews/product/1 \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "rating": 5,
    "comment": "Excellent produit !"
  }'
```

### 3. Modifier un avis

**Endpoint** : `PUT /api/reviews/:id`
**Authentification** : Requise (propri√©taire ou admin)

### 4. Supprimer un avis

**Endpoint** : `DELETE /api/reviews/:id`
**Authentification** : Requise (propri√©taire ou admin)

---

## ‚ù§Ô∏è Wishlist (Favoris)

**Toutes les routes n√©cessitent une authentification**

### 1. Voir ma wishlist

**Endpoint** : `GET /api/wishlist`

**Exemple curl** :
```bash
curl http://localhost:3000/api/wishlist \
  -H "Authorization: Bearer <token>"
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "product_id": 3,
        "name": "MacBook Pro 16\"",
        "description": "Ordinateur portable...",
        "price": 2499.99,
        "stock": 15,
        "image_url": "https://...",
        "created_at": "2024-01-01 16:00:00"
      }
    ],
    "count": 1
  }
}
```

### 2. Ajouter √† la wishlist

**Endpoint** : `POST /api/wishlist`

**Body** :
```json
{
  "product_id": 3
}
```

**Exemple curl** :
```bash
curl -X POST http://localhost:3000/api/wishlist \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{"product_id": 3}'
```

### 3. Retirer de la wishlist

**Endpoint** : `DELETE /api/wishlist/:product_id`

**Exemple curl** :
```bash
curl -X DELETE http://localhost:3000/api/wishlist/3 \
  -H "Authorization: Bearer <token>"
```

### 4. V√©rifier si un produit est dans la wishlist

**Endpoint** : `GET /api/wishlist/check/:product_id`

---

## üóÇ Structure du projet

```
ecommerce-backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js         # Configuration SQLite
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js   # Logique authentification
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoryController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cartController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orderController.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reviewController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wishlistController.js
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js             # Middleware JWT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js     # Gestion d'erreurs
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validator.js        # Validation des donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoryRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cartRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orderRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reviewRoutes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ wishlistRoutes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js            # Point d'entr√©e des routes
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seed.js             # Script de seed
‚îÇ   ‚îî‚îÄ‚îÄ server.js               # Point d'entr√©e de l'app
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üóÑ Base de donn√©es

### Sch√©ma SQLite

**users**
- id (PRIMARY KEY)
- name
- email (UNIQUE)
- password (hash√©)
- role (user|admin)
- created_at

**categories**
- id (PRIMARY KEY)
- name (UNIQUE)
- description
- created_at

**products**
- id (PRIMARY KEY)
- name
- description
- price
- stock
- category_id (FOREIGN KEY)
- image_url
- created_at

**cart**
- id (PRIMARY KEY)
- user_id (FOREIGN KEY, UNIQUE)
- created_at

**cart_items**
- id (PRIMARY KEY)
- cart_id (FOREIGN KEY)
- product_id (FOREIGN KEY)
- quantity
- created_at

**orders**
- id (PRIMARY KEY)
- user_id (FOREIGN KEY)
- total
- status
- created_at

**order_items**
- id (PRIMARY KEY)
- order_id (FOREIGN KEY)
- product_id (FOREIGN KEY)
- quantity
- unit_price
- created_at

**reviews**
- id (PRIMARY KEY)
- product_id (FOREIGN KEY)
- user_id (FOREIGN KEY)
- rating (1-5)
- comment
- created_at

**wishlist**
- id (PRIMARY KEY)
- user_id (FOREIGN KEY)
- product_id (FOREIGN KEY)
- created_at

### Relations

- `users` 1-1 `cart`
- `users` 1-N `orders`
- `users` 1-N `reviews`
- `users` 1-N `wishlist`
- `categories` 1-N `products`
- `products` 1-N `cart_items`
- `products` 1-N `order_items`
- `products` 1-N `reviews`
- `cart` 1-N `cart_items`
- `orders` 1-N `order_items`

## üîí S√©curit√©

### Mesures impl√©ment√©es

- ‚úÖ **Mots de passe hash√©s** avec bcrypt (10 rounds)
- ‚úÖ **JWT** pour l'authentification stateless
- ‚úÖ **Helmet** pour s√©curiser les headers HTTP
- ‚úÖ **CORS** configur√©
- ‚úÖ **Validation des entr√©es** avec express-validator
- ‚úÖ **Contraintes SQL** (cl√©s √©trang√®res, types, unique)
- ‚úÖ **Middleware d'autorisation** (admin, ownership)

### Bonnes pratiques recommand√©es

- Changer `JWT_SECRET` en production (utiliser une longue cha√Æne al√©atoire)
- Activer HTTPS en production
- Limiter les tentatives de connexion (rate limiting)
- Logger les actions sensibles
- Auditer les d√©pendances npm (`npm audit`)

## üìù Licence

MIT

## ü§ù Contribution

Les contributions sont les bienvenues ! N'h√©sitez pas √† ouvrir une issue ou une pull request.

---

**Fait avec ‚ù§Ô∏è en Node.js**
